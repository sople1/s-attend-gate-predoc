# User App - 출석 체크 기술 구현 사양

## 기술 개요

3단계 Fallback 시스템을 통한 출석 체크 기술 구현 세부사항을 정의합니다.

## 1. BLE 자동 감지 기술 사양

### 1.1 성능 지표
| 앱 상태 | 성공률 | 평균 처리 시간 | 비고 |
|---------|--------|----------------|------|
| 실행 상태 | 95-98% | 2-3초 | 최적 조건 |
| 백그라운드 | 80-85% | 5-7초 | OS 제약 존재 |
| 종료 상태 | - | - | QR코드 백업 필요 |

### 1.2 입/출장 판별 로직
#### 1순위: 시간 기반 판별
- 첫 감지 → **입장**
- 5분간 신호 없음 → **퇴장**

#### 2순위: RSSI 패턴 분석
- 신호 강도 증가 → 접근 (**입장**)
- 신호 강도 감소 → 멀어짐 (**퇴장**)

#### 3순위: GPS 보조 검증
- 위치 변화로 방향 판단

### 1.3 다층 검증 시스템
```
1차: BLE 비콘 감지 (근거리 확인)
2차: GPS 좌표 검증 (정확한 위치)  
3차: 지오펜스 경계 확인 (범위 검증)
4차: 시간 패턴 분석 (비정상 행동 감지)
```

### 1.4 예외 상황 처리
- **잠깐 외출**: 30분 이내 재입장 시 계속 참석 처리
- **중복 감지**: 단시간 내 재감지 무시
- **신호 간섭**: GPS 및 WiFi로 2차 검증

## 2. QR 코드 스캔 기술 사양

### 2.1 QR코드 형식
```json
{
  "event_id": "EVT-2024-001",
  "gate_id": "GATE-A1", 
  "timestamp": "2024-03-15T14:23:00Z",
  "location": {
    "lat": 37.5665,
    "lng": 126.9780,
    "accuracy": 10
  },
  "validation": {
    "expires_at": "2024-03-15T18:00:00Z",
    "checksum": "SHA256_HASH"
  }
}
```

### 2.2 처리 성능
- **스캔 인식 시간**: 평균 0.8초
- **서버 검증 시간**: 1-2초
- **전체 처리 시간**: 3-5초
- **성공률**: 98%

### 2.3 위치 검증
- **GPS 정확도**: ±10m 이내
- **지오펜스 범위**: 행사장 경계 기준
- **보조 검증**: WiFi SSID 매칭

### 2.4 오프라인 지원
- **임시 저장**: 로컬 SQLite DB
- **동기화 트리거**: 네트워크 복구 시 자동
- **충돌 방지**: 타임스탬프 기반 중복 제거

## 3. 관리자 도움 요청 기술 사양

### 3.1 개인 QR코드 생성
```json
{
  "type": "user_help_request",
  "user_id": "USER-123",
  "event_id": "EVT-2024-001",
  "request_time": "2024-03-15T14:23:00Z",
  "expires_at": "2024-03-15T14:26:00Z",
  "location_verified": true,
  "admin_approved": true,
  "one_time_use": true
}
```

### 3.2 보안 정책
- **유효 시간**: 3분
- **사용 횟수**: 1회 사용 후 만료
- **위치 제한**: 생성 위치 ±50m 이내
- **관리자 승인**: 실시간 승인 시스템

### 3.3 처리 성능
- **생성 시간**: 10-30초
- **승인 대기**: 평균 1분
- **성공률**: 99%

## 4. 네트워크 및 동기화

### 4.1 오프라인 모드
```javascript
// 오프라인 저장 구조
{
  attendance_records: [
    {
      user_id: "USER-123",
      event_id: "EVT-2024-001", 
      method: "qr_scan|ble_auto|manual_help",
      timestamp: "2024-03-15T14:23:00Z",
      location: {lat: 37.5665, lng: 126.9780},
      sync_status: "pending|synced|failed"
    }
  ]
}
```

### 4.2 동기화 로직
- **자동 동기화**: 네트워크 복구 시
- **충돌 해결**: 서버 타임스탬프 우선
- **재시도 정책**: 지수 백오프 (1s, 2s, 4s, 8s)
- **배치 처리**: 최대 100개 레코드

## 5. 성능 모니터링

### 5.1 실시간 지표
- **방법별 성공률**: BLE/QR/Manual 각각 추적
- **평균 처리 시간**: 5초 이하 목표
- **오류 발생률**: 1% 이하 목표
- **사용자 만족도**: 4.5/5.0 이상 목표

### 5.2 알림 임계값
- **성공률 90% 미만**: 즉시 알림
- **처리 시간 10초 초과**: 경고 알림
- **오류율 5% 초과**: 긴급 알림
- **대기 시간 3분 초과**: 관리자 알림

## 6. 보안 요구사항

### 6.1 데이터 암호화
- **전송 중**: TLS 1.3
- **저장 시**: AES-256
- **QR 데이터**: HMAC-SHA256 서명

### 6.2 개인정보 보호
- **위치 데이터**: 출석 확인 후 즉시 삭제
- **로그 보관**: 30일 후 자동 삭제
- **익명화**: 통계용 데이터는 개인 식별 제거

### 6.3 권한 관리
- **최소 권한**: 필요한 권한만 요청
- **권한 설명**: 각 권한의 사용 목적 명확히 제시
- **대안 제공**: 권한 거부 시에도 기능 이용 가능
